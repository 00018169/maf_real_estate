{% extends 'base.html' %}
{% load humanize %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        {% if property.image %}
        <img src="{{ property.image.url }}" class="img-fluid rounded mb-3" alt="{{ property.title }}">
        {% else %}
        <img src="https://via.placeholder.com/800x400" class="img-fluid rounded mb-3" alt="No image">
        {% endif %}
    </div>
    <div class="col-md-4">
        <h2>{{ property.title }}</h2>
        <h3 class="text-primary">${{ property.price|floatformat:0|intcomma }}</h3>
        <p class="text-muted">{{ property.city }}, {{ property.address }}</p>
        <hr>
        <p><strong>Type:</strong> {{ property.get_property_type_display }}</p>
        <p><strong>Area:</strong> {{ property.area|floatformat:0 }} mÂ²</p>
        <p><strong>Bedrooms:</strong> {{ property.bedrooms }}</p>
        <p><strong>Bathrooms:</strong> {{ property.bathrooms }}</p>
        <p><strong>Floors:</strong> {{ property.floors_total }}</p>
        <p><strong>Year Built:</strong> {{ property.year_built }}</p>

        <div class="mb-3">
            {% if property.has_gas %} <span class="badge bg-success">Gas</span> {% endif %}
            {% if property.has_electricity %} <span class="badge bg-success">Electricity</span> {% endif %}
            {% if property.has_internet %} <span class="badge bg-success">Internet</span> {% endif %}
        </div>

        <hr>
        <p><strong>Agent:</strong> {{ property.agent.user.get_full_name|default:property.agent.user.username }}</p>
        <p><strong>Agency:</strong> {{ property.agent.agency_name }}</p>
        <p><strong>Phone:</strong> {{ property.agent.phone }}</p>

        {% if user.is_authenticated %}
        {% if user.agent_profile == property.agent %}
        <a href="{% url 'update_property' property.pk %}" class="btn btn-warning w-100 mb-2">Edit Property</a>
        <a href="{% url 'delete_property' property.pk %}" class="btn btn-danger w-100">Delete Property</a>
        {% else %}
        <a href="{% url 'book_appointment' property.pk %}" class="btn btn-success w-100">Book Appointment</a>
        {% endif %}
        {% else %}
        <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-primary w-100">Login to Book</a>
        {% endif %}
    </div>
</div>
<div class="row mt-4">
    <div class="col-12">
        <h4>Description</h4>
        <p>{{ property.description }}</p>
        {% if property.last_major_renovation_at %}
        <p class="text-muted"><small>Last major renovation: {{ property.last_major_renovation_at }}</small></p>
        {% endif %}
    </div>
</div>
{% endblock %}